{"version":3,"file":"tiny-events.min.js","sources":["../src/tiny-events.ts","../src/index.ts"],"sourcesContent":["export type Selector = EventTarget | NodeList | string | null;\nexport type TinyEventsElements = EventTarget | NodeList | null;\nexport type TinyEventsElement = EventTarget | Node | null;\ninterface EventListener {\n    (evt: Event): void;\n}\ninterface MatchesElement extends Element {\n    matchesSelector(selectors: string): boolean;\n    msMatchesSelector(selectors: string): boolean;\n    mozMatchesSelector(selectors: string): boolean;\n    webkitMatchesSelector(selectors: string): boolean;\n    oMatchesSelector(selectors: string): boolean;\n}\n\nexport interface TinyEventsNode extends Node {\n    eventEmitterUUID: string;\n}\n// Custom event polyfill for old browsers\n// eslint-disable-next-line func-names\n(function () {\n    /* istanbul ignore next */\n    if (typeof window.CustomEvent === 'function') return false;\n\n    /* istanbul ignore next */\n    function CustomEvent(\n        event: string,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        params: { bubbles: boolean; cancelable: boolean; detail: any },\n    ) {\n        /* istanbul ignore next */\n        // eslint-disable-next-line no-param-reassign\n        params = params || { bubbles: false, cancelable: false, detail: null };\n        const evt = document.createEvent('CustomEvent');\n        evt.initCustomEvent(\n            event,\n            params.bubbles,\n            params.cancelable,\n            params.detail,\n        );\n        return evt;\n    }\n\n    /* istanbul ignore next */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (window as any).CustomEvent = CustomEvent;\n})();\n// eslint-disable-next-line import/prefer-default-export\nexport class TinyEvents {\n    elements: TinyEventsElements;\n\n    element: TinyEventsElement;\n\n    static eventListeners: { [x: string]: EventListener[] };\n\n    constructor(selector: Selector) {\n        this.elements = TinyEvents.getSelector(selector);\n        this.element = this.getFirstEl();\n        return this;\n    }\n\n    static getIdFromSelector(selector: string): string | undefined {\n        const selectors = selector.split(' ');\n        const lastSelector = selectors[selectors.length - 1];\n        const fl = lastSelector.substring(0, 1);\n        if (fl === '#') {\n            return lastSelector.substring(1);\n        }\n    }\n\n    static getSelector(selector: Selector): TinyEventsElements {\n        if (typeof selector !== 'string') {\n            return selector;\n        }\n\n        // For performance reasons, use getElementById\n        const id = TinyEvents.getIdFromSelector(selector);\n        if (id) {\n            return document.getElementById(id);\n        }\n        return document.querySelectorAll(selector);\n    }\n\n    static isNodeList(elements: TinyEventsElements): boolean {\n        if (!elements) {\n            return false;\n        }\n        return Object.prototype.isPrototypeOf.call(\n            NodeList.prototype,\n            elements,\n        );\n    }\n\n    getFirstEl(): Node {\n        if (TinyEvents.isNodeList(this.elements)) {\n            return (this.elements as NodeList)[0];\n        }\n        return this.elements as Node;\n    }\n\n    each(func: (el: TinyEventsElement, index: number) => void): this {\n        if (!this.elements) {\n            return this;\n        }\n        if (TinyEvents.isNodeList(this.elements)) {\n            [].slice\n                .call(this.elements as ArrayLike<Node>)\n                .forEach((el, index) => {\n                    func.call(el, el, index);\n                });\n        } else {\n            func.call(this.element, this.element, 0);\n        }\n        return this;\n    }\n\n    on(\n        eventNames: string,\n        selector: EventListener | string,\n        listener?: EventListener,\n    ): this {\n        // Manage multiple events\n        eventNames.split(' ').forEach((eventName) => {\n            this.each((el) => {\n                const tNEventName = TinyEvents.setEventName(\n                    el as TinyEventsNode,\n                    eventName,\n                );\n\n                let listenerFn = listener;\n                if (typeof selector === 'string') {\n                    listenerFn = (evt: Event) => {\n                        if (TinyEvents.foundTarget(evt.target, selector)) {\n                            if (typeof listener === 'function') {\n                                listener(evt);\n                            }\n                        }\n                    };\n                } else {\n                    listenerFn = selector;\n                }\n\n                if (typeof listenerFn === 'function') {\n                    if (\n                        !Array.isArray(TinyEvents.eventListeners[tNEventName])\n                    ) {\n                        TinyEvents.eventListeners[tNEventName] = [];\n                    }\n                    TinyEvents.eventListeners[tNEventName].push(listenerFn);\n\n                    // https://github.com/microsoft/TypeScript/issues/28357\n                    el?.addEventListener(\n                        eventName.split('.')[0],\n                        listenerFn as EventListener,\n                    );\n                }\n            });\n        });\n\n        return this;\n    }\n\n    static foundTarget(target: EventTarget | null, selector: string): boolean {\n        return (\n            TinyEvents.is(target as MatchesElement, selector) ||\n            TinyEvents.contains(selector, target as Node)\n        );\n    }\n\n    static createNewEvent(eventName: string): Event {\n        let event;\n        /* istanbul ignore next */\n        if (typeof Event === 'function') {\n            event = new Event(eventName);\n        } else {\n            /* istanbul ignore next */\n            event = document.createEvent('Event');\n            /* istanbul ignore next */\n            event.initEvent(eventName, true, true);\n        }\n        return event;\n    }\n\n    static generateUUID(): string {\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n            const r = (Math.random() * 16) | 0;\n            const v = c === 'x' ? r : (r & 0x3) | 0x8;\n            return v.toString(16);\n        });\n    }\n\n    static setEventName(el: TinyEventsNode, eventName: string): string {\n        // Need to verify https://stackoverflow.com/questions/1915341/whats-wrong-with-adding-properties-to-dom-element-objects\n        const elementUUId = el.eventEmitterUUID;\n        const uuid = elementUUId || TinyEvents.generateUUID();\n        // eslint-disable-next-line no-param-reassign\n        el.eventEmitterUUID = uuid;\n        return TinyEvents.getEventName(eventName, uuid);\n    }\n\n    static getElementEventName(el: TinyEventsNode, eventName: string): string {\n        const elementUUId = el.eventEmitterUUID;\n        /* istanbul ignore next */\n        const uuid = elementUUId || TinyEvents.generateUUID();\n        // eslint-disable-next-line no-param-reassign\n        el.eventEmitterUUID = uuid;\n        return TinyEvents.getEventName(eventName, uuid);\n    }\n\n    static getEventName(eventName: string, uuid: string): string {\n        return `${eventName}__EVENT_EMITTER__${uuid}`;\n    }\n\n    static getEventNameFromId(eventName: string): string {\n        return eventName.split('__EVENT_EMITTER__')[0];\n    }\n\n    one(\n        eventNames: string,\n        selector: EventListener | string,\n        listener?: EventListener,\n    ): this {\n        eventNames.split(' ').forEach((eventName) => {\n            this.each((el) => {\n                const listnerFn = (evt: Event) => {\n                    new TinyEvents(el).off(eventName);\n                    if (typeof selector === 'string') {\n                        if (listener) {\n                            listener(evt);\n                        }\n                    } else {\n                        selector(evt);\n                    }\n                };\n\n                if (typeof selector === 'string') {\n                    new TinyEvents(el).on(eventName, selector, listnerFn);\n                } else {\n                    new TinyEvents(el).on(eventName, listnerFn);\n                }\n            });\n        });\n        return this;\n    }\n\n    off(eventNames: string): this {\n        Object.keys(TinyEvents.eventListeners).forEach((tNEventName) => {\n            const currentEventName = TinyEvents.getEventNameFromId(tNEventName);\n            eventNames.split(' ').forEach((eventName) => {\n                if (TinyEvents.isEventMatched(eventName, currentEventName)) {\n                    this.each((el) => {\n                        if (\n                            TinyEvents.getElementEventName(\n                                el as TinyEventsNode,\n                                currentEventName,\n                            ) === tNEventName\n                        ) {\n                            TinyEvents.eventListeners[tNEventName].forEach(\n                                (listener) => {\n                                    (el as HTMLElement).removeEventListener(\n                                        currentEventName.split('.')[0],\n                                        listener,\n                                    );\n                                },\n                            );\n                            delete TinyEvents.eventListeners[tNEventName];\n                        }\n                    });\n                }\n            });\n        });\n        return this;\n    }\n\n    trigger(event: string, detail?: unknown): this {\n        if (!this.element) {\n            return this;\n        }\n        const eventName = event.split('.')[0];\n        const isNativeEvent =\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            typeof (document.body as any)[`on${eventName}`] !== 'undefined';\n        if (isNativeEvent) {\n            this.each((el) => {\n                el?.dispatchEvent(TinyEvents.createNewEvent(eventName));\n            });\n            return this;\n        }\n        const customEvent = new CustomEvent(eventName, {\n            detail: detail || null,\n        });\n        this.each((el) => {\n            el?.dispatchEvent(customEvent);\n        });\n        return this;\n    }\n\n    static contains(selector: string, child: Node): boolean {\n        let found = false;\n        // eslint-disable-next-line no-use-before-define\n        new TinyEvents(selector).each((el) => {\n            if (el !== child && (el as Node).contains(child)) {\n                found = true;\n            }\n        });\n        return found;\n    }\n\n    static is(el: MatchesElement, otherEl: string): boolean {\n        /* istanbul ignore next */\n        return (\n            el.matches ||\n            el.matchesSelector ||\n            el.msMatchesSelector ||\n            el.mozMatchesSelector ||\n            el.webkitMatchesSelector ||\n            el.oMatchesSelector\n        ).call(el, otherEl);\n    }\n\n    static isEventMatched(event: string, eventName: string): boolean {\n        const eventNamespace = eventName.split('.');\n        return event\n            .split('.')\n            .filter((e) => e)\n            .every((e) => eventNamespace.indexOf(e) !== -1);\n    }\n}\n\nTinyEvents.eventListeners = {};\n","import { Selector, TinyEvents } from './tiny-events';\n\nfunction tinyEvents(selector: Selector): TinyEvents {\n    return new TinyEvents(selector);\n}\nexport default tinyEvents;\n"],"names":["window","CustomEvent","event","params","bubbles","cancelable","detail","evt","document","createEvent","initCustomEvent","selector","this","elements","TinyEvents","getSelector","element","getFirstEl","selectors","split","lastSelector","length","substring","id","getIdFromSelector","getElementById","querySelectorAll","Object","prototype","isPrototypeOf","call","NodeList","isNodeList","func","slice","forEach","el","index","eventNames","listener","eventName","_this","each","tNEventName","setEventName","listenerFn","foundTarget","target","Array","isArray","eventListeners","push","addEventListener","is","contains","Event","initEvent","replace","c","r","Math","random","toString","uuid","eventEmitterUUID","generateUUID","getEventName","listnerFn","off","on","keys","currentEventName","getEventNameFromId","isEventMatched","getElementEventName","removeEventListener","body","dispatchEvent","createNewEvent","customEvent","child","found","otherEl","matches","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","eventNamespace","filter","e","every","indexOf"],"mappings":"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"}